<!DOCTYPE html>
<html>
<head>
  <title>Test Frontend API</title>
  <script type="module">
    import { db } from './utils/database.ts';

    async function testStayCategory() {
      console.log('ğŸ§ª ìˆ™ë°• ì¹´í…Œê³ ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘');

      try {
        // ì§ì ‘ DB ì¿¼ë¦¬
        const result = await db.query(`
          SELECT l.*, c.slug as category_slug, c.name_ko as category_name
          FROM listings l
          LEFT JOIN categories c ON l.category_id = c.id
          WHERE l.is_published = 1 AND c.slug = ?
          ORDER BY l.view_count DESC, l.booking_count DESC
          LIMIT 20
        `, ['stay']);

        console.log('âœ… ê²°ê³¼:', result);
        console.log('ğŸ“Š ìƒí’ˆ ê°œìˆ˜:', result.length);

        if (result.length > 0) {
          result.forEach((item, idx) => {
            console.log(`${idx + 1}. ${item.title} (${item.category_name})`);
          });
        } else {
          console.log('âš ï¸ ìˆ™ë°• ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤');
        }

        document.getElementById('result').innerHTML = `
          <h2>ìˆ™ë°• ìƒí’ˆ: ${result.length}ê°œ</h2>
          <ul>
            ${result.map(item => `<li>${item.title} - ${item.price_from}ì›</li>`).join('')}
          </ul>
        `;

      } catch (error) {
        console.error('âŒ ì˜¤ë¥˜:', error);
        document.getElementById('result').innerHTML = `<p style="color: red;">ì˜¤ë¥˜: ${error.message}</p>`;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', testStayCategory);
  </script>
</head>
<body>
  <h1>ìˆ™ë°• ì¹´í…Œê³ ë¦¬ API í…ŒìŠ¤íŠ¸</h1>
  <div id="result">ë¡œë”© ì¤‘...</div>
</body>
</html>
