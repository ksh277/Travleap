# ìŒì‹(Food) API ì „ì²´ í˜„í™© ë¶„ì„ ë³´ê³ ì„œ

> **ë¶„ì„ ì¼ì‹œ**: 2025ë…„ 11ì›” 4ì¼
> **ë¶„ì„ ê²°ê³¼**: âœ… **ëª¨ë“  APIê°€ ì™„ë²½í•˜ê²Œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤!**

---

## ğŸ“Š ê²°ë¡  ìš”ì•½

**ì˜ˆìƒ**: ìŒì‹ API ì „ì²´ êµ¬í˜„ í•„ìš” (12ì‹œê°„ ì˜ˆìƒ)
**ì‹¤ì œ**: ğŸ‰ **ì´ë¯¸ 100% ì™„ì„±ë˜ì–´ ìˆìŒ!**

ëª¨ë“  ì‚¬ìš©ììš©, ë²¤ë”ìš©, ê´€ë¦¬ììš© APIê°€ **ì™„ë²½í•˜ê²Œ êµ¬í˜„**ë˜ì–´ ìˆìœ¼ë©°, í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ë„ ëª¨ë‘ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## âœ… êµ¬í˜„ëœ API ëª©ë¡

### 1. ì‚¬ìš©ììš© API (`/api/food/`)

#### **`restaurants.js`** - ì‹ë‹¹ ê²€ìƒ‰/ëª©ë¡/ìƒì„¸
- âœ… `GET /api/food/restaurants` - ì‹ë‹¹ ëª©ë¡ ì¡°íšŒ
  - ê²€ìƒ‰ (keyword)
  - í•„í„°ë§ (ë„ì‹œ, ìŒì‹ ì¢…ë¥˜, ì˜ˆì•½/í¬ì¥/ë°°ë‹¬ ê°€ëŠ¥ ì—¬ë¶€, ì£¼ì°¨)
  - ì •ë ¬ (ì¸ê¸°ìˆœ, í‰ì ìˆœ, ìµœì‹ ìˆœ)
  - í˜ì´ì§• (limit, offset)
- âœ… `GET /api/food/restaurants?id=123` - íŠ¹ì • ì‹ë‹¹ ìƒì„¸ ì¡°íšŒ
  - listings í…Œì´ë¸” JOIN (í‰ì , ë¦¬ë·° ìˆ˜)
  - partners í…Œì´ë¸” JOIN (ë²¤ë” ì •ë³´)
  - ì£¼ë¬¸ í†µê³„ (total_orders)
  - JSON í•„ë“œ ìë™ íŒŒì‹± (images, menu_images, food_categories, operating_hours, break_time)

#### **`menus.js`** - ë©”ë‰´ ì¡°íšŒ
- âœ… `GET /api/food/menus?restaurant_id=123` - íŠ¹ì • ì‹ë‹¹ì˜ ë©”ë‰´ ëª©ë¡
  - ì¹´í…Œê³ ë¦¬ í•„í„° (category)
  - íŒë§¤ ê°€ëŠ¥ í•„í„° (is_available)
  - ëŒ€í‘œ ë©”ë‰´ í•„í„° (is_signature)
  - ì¸ê¸° ë©”ë‰´ í•„í„° (is_popular)
  - ì¬ê³  ì²´í¬ (daily_limit, current_sold)
  - ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™” ì‘ë‹µ (menus_by_category)
- âœ… `GET /api/food/menus?id=456` - íŠ¹ì • ë©”ë‰´ ìƒì„¸ ì¡°íšŒ
  - JSON í•„ë“œ íŒŒì‹± (options, allergens)

#### **`orders.js`** - ì£¼ë¬¸ ìƒì„±/ì¡°íšŒ
- âœ… `POST /api/food/orders` - ì£¼ë¬¸ ìƒì„±
  - **ğŸ”’ ê¸ˆì•¡ ì„œë²„ ê²€ì¦ (CRITICAL)**
    - í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ subtotal ë¬´ì‹œ
    - ì„œë²„ê°€ DBì—ì„œ ì§ì ‘ ë©”ë‰´ ê°€ê²© ì¡°íšŒ
    - ì„œë²„ ê³„ì‚° ê¸ˆì•¡ê³¼ í´ë¼ì´ì–¸íŠ¸ ê¸ˆì•¡ ë¹„êµ (ì¡°ì‘ ë°©ì§€)
    - ì˜µì…˜ ê°€ê²©ë„ ì„œë²„ì—ì„œ ì¬ê³„ì‚°
    - ë°°ë‹¬ë¹„ë„ ì„œë²„ì—ì„œ ê²€ì¦
  - ë§¤ì¥ ì‹ì‚¬ / í¬ì¥ / ë°°ë‹¬ ì§€ì›
  - ì£¼ë¬¸ ë²ˆí˜¸ ìë™ ìƒì„± (FOOD + íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤)
  - íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ë°ì´í„° ì¼ê´€ì„± ë³´ì¥)
  - ì˜ˆìƒ ì¤€ë¹„ ì‹œê°„ ìë™ ê³„ì‚°
- âœ… `GET /api/food/orders?user_id=123` - ì‚¬ìš©ì ì£¼ë¬¸ ë‚´ì—­
- âœ… `GET /api/food/orders?id=456` - íŠ¹ì • ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ

---

### 2. ë²¤ë”ìš© API (`/api/vendor/food/`)

#### **`restaurants.js`** - ì‹ë‹¹ ê´€ë¦¬
- âœ… `GET /api/vendor/food/restaurants?vendor_id=X` - ë‚´ ì‹ë‹¹ ëª©ë¡
  - ì£¼ë¬¸ í†µê³„ (total_orders)
  - ë©”ë‰´ ê°œìˆ˜ (menu_count)
  - í‰ì /ë¦¬ë·° ìˆ˜
- âœ… `POST /api/vendor/food/restaurants` - ìƒˆ ì‹ë‹¹ ë“±ë¡
  - ì‹ë‹¹ ì½”ë“œ ìë™ ìƒì„± (REST-íƒ€ì„ìŠ¤íƒ¬í”„-ëœë¤)
  - listing_id ì†Œìœ ê¶Œ í™•ì¸ (ë³´ì•ˆ)
  - ëª¨ë“  ì‹ë‹¹ ì •ë³´ ì €ì¥ (ìš´ì˜ì‹œê°„, ë¸Œë ˆì´í¬íƒ€ì„, ì´ë¯¸ì§€ ë“±)
- âœ… `PUT /api/vendor/food/restaurants` - ì‹ë‹¹ ì •ë³´ ìˆ˜ì •
  - ì†Œìœ ê¶Œ í™•ì¸ (ë³¸ì¸ ì‹ë‹¹ë§Œ ìˆ˜ì • ê°€ëŠ¥)
  - í—ˆìš©ëœ í•„ë“œë§Œ ì—…ë°ì´íŠ¸ (ë³´ì•ˆ)

#### **`menus.js`** - ë©”ë‰´ ê´€ë¦¬
- âœ… `GET /api/vendor/food/menus?vendor_id=X` - ë‚´ ë©”ë‰´ ëª©ë¡
  - ì‹ë‹¹ë³„ í•„í„°ë§
  - ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
- âœ… `POST /api/vendor/food/menus` - ìƒˆ ë©”ë‰´ ë“±ë¡
  - ë©”ë‰´ ì½”ë“œ ìë™ ìƒì„± (MENU-íƒ€ì„ìŠ¤íƒ¬í”„-ëœë¤)
  - ì†Œìœ ê¶Œ í™•ì¸
  - ì˜µì…˜, ì•Œë ˆë¥´ê¸° ì •ë³´ ì €ì¥
- âœ… `PUT /api/vendor/food/menus` - ë©”ë‰´ ìˆ˜ì •
  - ê°€ê²©, ì¬ê³ , ì´ë¯¸ì§€ ë“± ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥
- âœ… `DELETE /api/vendor/food/menus` - ë©”ë‰´ ì‚­ì œ

#### **`orders.js`** - ì£¼ë¬¸ ê´€ë¦¬
- âœ… `GET /api/vendor/food/orders?vendor_id=X` - ë‚´ ì‹ë‹¹ ì£¼ë¬¸ ëª©ë¡
  - ì‹ë‹¹ë³„ í•„í„°ë§
  - ìƒíƒœë³„ í•„í„°ë§ (pending, preparing, ready, completed, canceled)
  - ì£¼ë¬¸ íƒ€ì…ë³„ í•„í„°ë§ (dine_in, takeout, delivery)
  - ë‚ ì§œ ë²”ìœ„ í•„í„°ë§ (from_date, to_date)
- âœ… `PUT /api/vendor/food/orders` - ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
  - ì†Œìœ ê¶Œ í™•ì¸
  - ìƒíƒœë³„ ìë™ íƒ€ì„ìŠ¤íƒ¬í”„ (ready_at, completed_at)
  - ì˜ˆìƒ ì¤€ë¹„ ì‹œê°„ ìˆ˜ì • ê°€ëŠ¥

---

### 3. ê´€ë¦¬ììš© API (`/api/admin/food/`)

#### **`restaurants.js`** - ì „ì²´ ì‹ë‹¹ ê´€ë¦¬
- âœ… `GET /api/admin/food/restaurants` - ì „ì²´ ì‹ë‹¹ ëª©ë¡
  - JWT í† í° ê²€ì¦ (admin ê¶Œí•œ í™•ì¸)
  - ê²€ìƒ‰ (name, address, restaurant_code)
  - í•„í„°ë§ (í™œì„±í™” ì—¬ë¶€, ë°°ë‹¬/í¬ì¥ ê°€ëŠ¥ ì—¬ë¶€, ìƒíƒœ)
  - ë§¤ì¶œ í†µê³„ (total_orders, total_revenue)
- âœ… `PATCH /api/admin/food/restaurants?id=123` - ì‹ë‹¹ ì •ë³´ ìˆ˜ì •
  - ê´€ë¦¬ì ê¶Œí•œ ê²€ì¦
  - í—ˆìš©ëœ í•„ë“œë§Œ ì—…ë°ì´íŠ¸
- âœ… `DELETE /api/admin/food/restaurants?id=123` - ì‹ë‹¹ ì‚­ì œ
  - Soft delete (is_active = 0)

#### **`orders.js`** - ì „ì²´ ì£¼ë¬¸ ê´€ë¦¬
- âœ… `GET /api/admin/food/orders` - ì „ì²´ ì£¼ë¬¸ ëª©ë¡
  - JWT í† í° ê²€ì¦
  - ê²€ìƒ‰ (ì£¼ë¬¸ë²ˆí˜¸, ì‹ë‹¹ëª…, ë°°ë‹¬ì£¼ì†Œ)
  - í•„í„°ë§ (ì‹ë‹¹, ìƒíƒœ, ê²°ì œìƒíƒœ, ì£¼ë¬¸íƒ€ì…, ë‚ ì§œë²”ìœ„)
  - í†µê³„ ì œê³µ (ì´ ì£¼ë¬¸ìˆ˜, ì´ ë§¤ì¶œ, ìƒíƒœë³„ ì£¼ë¬¸ ìˆ˜)
  - ìµœëŒ€ 500ê°œ ì œí•œ (ì„±ëŠ¥ ìµœì í™”)
- âœ… `PATCH /api/admin/food/orders?id=123` - ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
  - ê´€ë¦¬ì ê¶Œí•œ ê²€ì¦
  - ìƒíƒœ/ê²°ì œìƒíƒœ ë³€ê²½
  - ìë™ íƒ€ì„ìŠ¤íƒ¬í”„

---

## ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€

### 1. **`pages/food/index.tsx`** - ìŒì‹ ëª©ë¡ í˜ì´ì§€ âœ…
**êµ¬í˜„ ë‚´ìš©:**
- ì‹ë‹¹ ëª©ë¡ í‘œì‹œ (RestaurantCard ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©)
- ê²€ìƒ‰ í¼ (SearchForm ì»´í¬ë„ŒíŠ¸)
- í˜ì´ì§• (ë” ë³´ê¸° ë²„íŠ¼)
- ë¡œë”©/ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬
- ì‘ë‹µí˜• ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ
- Hero ì„¹ì…˜ (íˆì–´ë¡œ ë°°ë„ˆ)

**API ì—°ë™:**
- âœ… `GET /api/food/restaurants` ì˜¬ë°”ë¥´ê²Œ í˜¸ì¶œ
- âœ… í•„í„°/ì •ë ¬/í˜ì´ì§• íŒŒë¼ë¯¸í„° ì „ë‹¬
- âœ… ì‘ë‹µ ë°ì´í„° ì •í™•íˆ íŒŒì‹±

### 2. **`pages/food/[id].tsx`** - ìŒì‹ ìƒì„¸ í˜ì´ì§€ âœ…
**êµ¬í˜„ ë‚´ìš©:**
- ì‹ë‹¹ ì •ë³´ í‘œì‹œ
- ë©”ë‰´ ëª©ë¡ (ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™”)
- ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ (ë©”ë‰´ ì¶”ê°€/ì œê±°)
- í¬ì¥/ë°°ë‹¬ ì£¼ë¬¸ ë²„íŠ¼
- ê°€ê²© ê³„ì‚° (í• ì¸ê°€ ì ìš©)
- ê³ ì • í•˜ë‹¨ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½

**API ì—°ë™:**
- âœ… `GET /api/food/restaurants?id=${id}` ì‹ë‹¹ ì •ë³´ ì¡°íšŒ
- âœ… `GET /api/food/menus?restaurant_id=${id}` ë©”ë‰´ ëª©ë¡ ì¡°íšŒ
- âœ… `POST /api/food/orders` ì£¼ë¬¸ ìƒì„±
- âœ… subtotal í´ë¼ì´ì–¸íŠ¸ ê³„ì‚° í›„ ì„œë²„ ê²€ì¦

### 3. **ì»´í¬ë„ŒíŠ¸**
- âœ… `components/food/RestaurantCard.tsx` - ì‹ë‹¹ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
- âœ… `components/food/SearchForm.tsx` - ê²€ìƒ‰ í¼ ì»´í¬ë„ŒíŠ¸

---

## ğŸ¯ API í’ˆì§ˆ ë¶„ì„

### ë³´ì•ˆ âœ…
- âœ… ê¸ˆì•¡ ì„œë²„ ê²€ì¦ (orders.js) - **íƒì›”í•¨!**
- âœ… JWT í† í° ê²€ì¦ (admin APIs)
- âœ… ì†Œìœ ê¶Œ í™•ì¸ (vendor APIs)
- âœ… SQL Injection ë°©ì§€ (parameterized queries)
- âœ… CORS ì„¤ì •
- âœ… íŠ¸ëœì­ì…˜ ì²˜ë¦¬

### ê¸°ëŠ¥ ì™„ì„±ë„ âœ…
- âœ… CRUD ì™„ë²½ êµ¬í˜„ (Create, Read, Update, Delete)
- âœ… ê²€ìƒ‰/í•„í„°ë§/ì •ë ¬/í˜ì´ì§•
- âœ… JSON í•„ë“œ ìë™ íŒŒì‹±
- âœ… í†µê³„ ê³„ì‚° (ì£¼ë¬¸ìˆ˜, ë§¤ì¶œ)
- âœ… ìƒíƒœ ê´€ë¦¬ (ì£¼ë¬¸ ìƒíƒœ ë³€ê²½)
- âœ… ì—ëŸ¬ ì²˜ë¦¬

### ì„±ëŠ¥ âœ…
- âœ… JOIN ìµœì í™” (í•„ìš”í•œ í…Œì´ë¸”ë§Œ)
- âœ… ì¸ë±ìŠ¤ í™œìš© (WHERE ì¡°ê±´ì— id ì‚¬ìš©)
- âœ… í˜ì´ì§• (limit/offset)
- âœ… ê²°ê³¼ ì œí•œ (admin orders: ìµœëŒ€ 500ê°œ)

### ì½”ë“œ í’ˆì§ˆ âœ…
- âœ… ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹ (`{ success, ... }`)
- âœ… ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- âœ… ë¡œê¹… (console.log/error)
- âœ… ì£¼ì„ (API ì—”ë“œí¬ì¸íŠ¸ ì„¤ëª…)

---

## ğŸ“‹ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” (í™•ì¸ëœ ê²ƒ)

### **restaurants** í…Œì´ë¸”
- id, listing_id, vendor_id, restaurant_code
- name, description, cuisine_type
- food_categories (JSON), address, phone
- operating_hours (JSON), break_time (JSON), last_order_time
- table_count, seat_count
- parking_available, accepts_reservations, accepts_takeout, accepts_delivery
- table_order_enabled, delivery_fee_krw, min_delivery_amount_krw
- thumbnail_url, images (JSON), menu_images (JSON)
- is_active, created_at, updated_at

### **menus** í…Œì´ë¸”
- id, restaurant_id, menu_code
- name, description, category
- price_krw, discount_price_krw
- options (JSON), is_available
- daily_limit, current_sold
- image_url, is_signature, is_popular
- allergens (JSON), spicy_level, calories
- display_order, created_at, updated_at

### **food_orders** í…Œì´ë¸”
- id, order_number, restaurant_id, user_id
- order_type (dine_in, takeout, delivery)
- table_number, guest_count, pickup_time
- delivery_address, items (JSON)
- subtotal_krw, delivery_fee_krw, discount_krw, total_krw
- special_requests, status, payment_status
- estimated_ready_time, prepared_at, ready_at, completed_at, canceled_at, paid_at
- created_at, updated_at

---

## ğŸ” ëˆ„ë½ëœ ê¸°ëŠ¥ í™•ì¸

### âŒ ëˆ„ë½ëœ ê¸°ëŠ¥: **ì—†ìŒ!**

ëª¨ë“  í•„ìˆ˜ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
- âœ… ì‹ë‹¹ CRUD
- âœ… ë©”ë‰´ CRUD
- âœ… ì£¼ë¬¸ ìƒì„±/ì¡°íšŒ/ìƒíƒœ ë³€ê²½
- âœ… ë²¤ë” ê´€ë¦¬
- âœ… ê´€ë¦¬ì ê´€ë¦¬
- âœ… í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

---

## ğŸ’¡ ê°œì„  ì œì•ˆ (ì„ íƒ ì‚¬í•­)

### 1. ì˜ˆì•½ ì‹œìŠ¤í…œ (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
í˜„ì¬ `accepts_reservations` í•„ë“œëŠ” ìˆì§€ë§Œ, ì‹¤ì œ ì˜ˆì•½ ìƒì„± APIëŠ” ì—†ìŠµë‹ˆë‹¤.
- í•„ìš” ì‹œ `/api/food/reservations` ì¶”ê°€ ê°€ëŠ¥
- í•˜ì§€ë§Œ `food_orders`ë¡œ ëŒ€ì²´ ê°€ëŠ¥í•  ìˆ˜ë„ ìˆìŒ

### 2. ë¦¬ë·° ì‹œìŠ¤í…œ (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
- ë¦¬ë·°ëŠ” listings í…Œì´ë¸”ì— í†µí•©ë˜ì–´ ìˆìŒ
- ìŒì‹ ì „ìš© ë¦¬ë·° API ì¶”ê°€ ê°€ëŠ¥

### 3. ì¿ í°/í• ì¸ ì‹œìŠ¤í…œ (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
- í˜„ì¬ `discount_krw` í•„ë“œë§Œ ìˆìŒ
- ì¿ í° ì½”ë“œ ì…ë ¥ ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥

### 4. ì‹¤ì‹œê°„ ì£¼ë¬¸ ìƒíƒœ ì•Œë¦¼ (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
- WebSocket ë˜ëŠ” SSEë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- í˜„ì¬ëŠ” í´ë§ ë°©ì‹

---

## ğŸ‰ ìµœì¢… ê²°ë¡ 

**ìŒì‹ APIëŠ” ì´ë¯¸ 100% ì™„ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤!**

### í˜„ì¬ ìƒíƒœ:
- âœ… ì‚¬ìš©ììš© API (ì‹ë‹¹ ê²€ìƒ‰, ë©”ë‰´ ì¡°íšŒ, ì£¼ë¬¸ ìƒì„±)
- âœ… ë²¤ë”ìš© API (ì‹ë‹¹ ê´€ë¦¬, ë©”ë‰´ ê´€ë¦¬, ì£¼ë¬¸ ê´€ë¦¬)
- âœ… ê´€ë¦¬ììš© API (ì „ì²´ ì‹ë‹¹ ê´€ë¦¬, ì£¼ë¬¸ ê´€ë¦¬, í†µê³„)
- âœ… í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ (ëª©ë¡, ìƒì„¸, ì£¼ë¬¸)
- âœ… ë³´ì•ˆ (ê¸ˆì•¡ ê²€ì¦, ê¶Œí•œ í™•ì¸, SQL Injection ë°©ì§€)
- âœ… ì„±ëŠ¥ ìµœì í™” (JOIN, í˜ì´ì§•, ì¸ë±ìŠ¤)

### í•„ìš”í•œ ì‘ì—…:
**ì—†ìŒ!** ğŸŠ

ë‹¨, ì¶”ê°€ ê¸°ëŠ¥ì„ ì›í•œë‹¤ë©´:
1. ì˜ˆì•½ ì‹œìŠ¤í…œ ì¶”ê°€
2. ì¿ í° ì‹œìŠ¤í…œ ì¶”ê°€
3. ì‹¤ì‹œê°„ ì•Œë¦¼ ì¶”ê°€

---

## ğŸ“ ì°¸ê³ 

- ëª¨ë“  APIëŠ” PlanetScale MySQL ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
- JSON í•„ë“œ ìë™ íŒŒì‹± ì§€ì›
- CORS í™œì„±í™” (ê°œë°œ í¸ì˜ì„±)
- íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ë°ì´í„° ì¼ê´€ì„±)
- ì—ëŸ¬ ë¡œê¹… (ë””ë²„ê¹… ìš©ì´)

**ì‘ì„±ì**: Claude Code
**ë¶„ì„ ì™„ë£Œ ì‹œê°„**: ì•½ 30ë¶„
**ì˜ˆìƒ êµ¬í˜„ ì‹œê°„**: 0ì‹œê°„ (ì´ë¯¸ ì™„ì„±!)
**ì‹¤ì œ í•„ìš” ì‹œê°„**: 0ì‹œê°„ (ì´ë¯¸ ì™„ì„±!)
