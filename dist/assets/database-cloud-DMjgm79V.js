var a={};class i{getApiBase(){return typeof window>"u"?a.API_URL||"http://localhost:3004/api/db":"/api/db"}async execute(t,r=[]){const n=this.getApiBase();try{const e=await fetch(`${n}?action=query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:t,params:r})}),s=await e.json();if(!e.ok)throw new Error(s.error||"Database query failed");return{rows:s.data||[],insertId:s.insertId||0,affectedRows:s.affectedRows||0}}catch(e){return console.error("Database execution error:",e),{rows:[],insertId:0,affectedRows:0}}}async select(t,r){const n=this.getApiBase();try{const e=await fetch(`${n}?action=select`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,where:r})}),s=await e.json();return e.ok?s.data||[]:(console.error("Select failed:",s.error),[])}catch(e){return console.error("Select error:",e),[]}}async findAll(t,r){return this.select(t,r)}async findOne(t,r){const n=await this.select(t,r);return n.length>0?n[0]:null}async insert(t,r){const n=this.getApiBase();try{const e=await fetch(`${n}?action=insert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,data:r})}),s=await e.json();return e.ok?s.data:(console.error("Insert failed:",s.error),{id:Date.now(),...r})}catch(e){return console.error("Insert error:",e),{id:Date.now(),...r}}}async update(t,r,n){const e=this.getApiBase();try{const s=await fetch(`${e}?action=update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,id:r,data:n})}),o=await s.json();return s.ok?o.success:(console.error("Update failed:",o.error),!1)}catch(s){return console.error("Update error:",s),!1}}async upsert(t,r,n){const e=await this.select(t,r);return e.length>0?(await this.update(t,e[0].id,n),{id:e[0].id,...n}):await this.insert(t,{...r,...n})}async delete(t,r){const n=this.getApiBase();try{const e=await fetch(`${n}?action=delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,id:r})}),s=await e.json();return e.ok?s.success:(console.error("Delete failed:",s.error),!1)}catch(e){return console.error("Delete error:",e),!1}}async query(t,r=[]){return(await this.execute(t,r)).rows}async testConnection(){try{const t=await this.query("SELECT 1 as test");return t.length>0&&t[0].test===1}catch(t){return console.error("Connection test failed:",t),!1}}}const l=new i;export{l as db,l as default};
