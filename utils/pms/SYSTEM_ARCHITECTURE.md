# PMS í†µí•© ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ“– ê°œìš”

íŠ¸ë˜ë¸”ì•±(ì—¬í–‰/ìˆ™ë°• ì˜ˆì•½ í”Œë«í¼)ì˜ PMS(Property Management System) í†µí•© ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**í•µì‹¬ ëª©í‘œ:**
- ìˆ™ë°•ì—…ì²´ì˜ ê°ì‹¤ ì¬ê³ ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°íšŒ
- ê²°ì œì™€ í•¨ê»˜ ì˜ˆì•½ì„ í™•ì •
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ PMS APIë¥¼ í†µí•´ ê°ì‹¤ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ ìƒí’ˆ ì¶”ê°€

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (React)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ìƒí’ˆ ê²€ìƒ‰/    â”‚  â”‚  ì˜ˆì•½ í˜ì´ì§€   â”‚  â”‚ ê´€ë¦¬ì í˜ì´ì§€â”‚  â”‚
â”‚  â”‚  ì¬ê³  ì¡°íšŒ     â”‚  â”‚  (ê²°ì œ)        â”‚  â”‚ (PMS ì—°ë™)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â”‚              â”‚
               â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Backend API Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GET  /api/inventory/:hotelId/:roomTypeId                   â”‚
â”‚  POST /api/booking/checkout                                 â”‚
â”‚  POST /api/admin/pms/fetch-hotel-data                       â”‚
â”‚  POST /api/webhooks/pms/:vendor                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â”‚              â”‚
               â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PMS Integration Layer                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PMSService  â”‚  â”‚ BookingAPI   â”‚  â”‚ AdminIntegrationâ”‚  â”‚
â”‚  â”‚  (ì¬ê³ /ìš”ê¸ˆ) â”‚  â”‚ (ì˜ˆì•½ ì²˜ë¦¬)  â”‚  â”‚ (ìƒí’ˆ ì¶”ê°€)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WebhookHandlerâ”‚ â”‚ PollingSync  â”‚  â”‚ FallbackStrategyâ”‚  â”‚
â”‚  â”‚ (ì‹¤ì‹œê°„ ë™ê¸°í™”)â”‚ â”‚ (ì£¼ê¸° ë™ê¸°í™”)â”‚  â”‚ (ì¥ì•  ëŒ€ì‘)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼       â”‚       â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Redis  â”‚   â”‚Database â”‚  â”‚  â”‚ PMS API â”‚  â”‚ Payment  â”‚
  â”‚ (Cache) â”‚   â”‚ (Supabase)â”‚ â”‚ â”‚CloudBedsâ”‚  â”‚ Gateway  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Polling  â”‚
                        â”‚ Schedulerâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ í•µì‹¬ í”Œë¡œìš°

### 1. ì¬ê³  ì¡°íšŒ í”Œë¡œìš° (ì½ê¸°)

```
ì‚¬ìš©ì ê²€ìƒ‰
    â”‚
    â–¼
GET /api/inventory/:hotelId/:roomTypeId?startDate=2025-11-01&endDate=2025-11-03
    â”‚
    â–¼
PMSService.getInventory()
    â”‚
    â”œâ”€â†’ Redis ìºì‹œ í™•ì¸
    â”‚   â””â”€â†’ ìºì‹œ HIT â†’ ê²°ê³¼ ë°˜í™˜
    â”‚
    â””â”€â†’ ìºì‹œ MISS
        â”‚
        â–¼
    PMS API í˜¸ì¶œ (CloudBeds, Opera ë“±)
        â”‚
        â–¼
    Redis ìºì‹œ ì €ì¥ (TTL: 90ì´ˆ)
        â”‚
        â–¼
    ê²°ê³¼ ë°˜í™˜
```

**ìºì‹œ í‚¤ êµ¬ì¡°:**
```
inv:{hotelId}:{roomTypeId}:{date}
ì˜ˆ: inv:hotel_123:room_456:2025-11-01
```

### 2. ì˜ˆì•½ í™•ì • í”Œë¡œìš° (ì“°ê¸°)

```
ì‚¬ìš©ì ì˜ˆì•½ ìš”ì²­
    â”‚
    â–¼
POST /api/booking/checkout
    â”‚
    â–¼
[1ë‹¨ê³„] ì¬ê³  í™•ì¸
    â”‚
    â–¼
[2ë‹¨ê³„] Hold ìƒì„± (PMSì— 180ì´ˆ ì ê¸ˆ)
    â”‚
    â–¼
[3ë‹¨ê³„] ê²°ì œ PreAuth (ì‚¬ì „ ìŠ¹ì¸)
    â”‚
    â”œâ”€â†’ ì‹¤íŒ¨ â†’ Hold í•´ì œ â†’ ì—ëŸ¬ ë°˜í™˜
    â”‚
    â–¼
[4ë‹¨ê³„] ì˜ˆì•½ í™•ì • (PMS Confirm)
    â”‚
    â”œâ”€â†’ ì‹¤íŒ¨ â†’ Hold í•´ì œ + PreAuth ì·¨ì†Œ â†’ ì—ëŸ¬ ë°˜í™˜
    â”‚
    â–¼
[5ë‹¨ê³„] ê²°ì œ Capture (ì‹¤ì œ ê²°ì œ)
    â”‚
    â””â”€â†’ ì„±ê³µ â†’ ì˜ˆì•½ ì™„ë£Œ (bookingId ë°˜í™˜)
```

**ì—ëŸ¬ ì²˜ë¦¬:**
- ê° ë‹¨ê³„ ì‹¤íŒ¨ ì‹œ ì´ì „ ë‹¨ê³„ ë¡¤ë°±
- Hold ë§Œë£Œ ì‹œê°„: 180ì´ˆ (3ë¶„)
- PreAuth ìœ íš¨ ì‹œê°„: PGì‚¬ë³„ ìƒì´ (ì¼ë°˜ì ìœ¼ë¡œ 24ì‹œê°„)

### 3. Admin ìƒí’ˆ ì¶”ê°€ í”Œë¡œìš°

```
ê´€ë¦¬ì "ìˆ™ë°• ìƒí’ˆ ì¶”ê°€" í´ë¦­
    â”‚
    â–¼
PMSIntegrationModal ì—´ë¦¼
    â”‚
    â–¼
[ì…ë ¥] PMS Vendor, Hotel ID, API Key
    â”‚
    â–¼
fetchHotelDataFromPMS(config)
    â”‚
    â”œâ”€â†’ PMS API: ê°ì‹¤ íƒ€ì… ì¡°íšŒ
    â”‚
    â”œâ”€â†’ PMS API: í–¥í›„ 30ì¼ ì¬ê³  ì¡°íšŒ
    â”‚
    â””â”€â†’ PMS API: í–¥í›„ 30ì¼ ìš”ê¸ˆ ì¡°íšŒ
    â”‚
    â–¼
convertPMSDataToFormData()
    â”‚
    â–¼
ìë™ìœ¼ë¡œ ì…ë ¥ í¼ ìƒì„±
    - í˜¸í…”ëª…, ìœ„ì¹˜, ê°ì‹¤ íƒ€ì…ë³„ ì •ë³´
    - í‰ê·  ê°€ê²©, ì¬ê³ , ì´ë¯¸ì§€ ë“±
    â”‚
    â–¼
[ê´€ë¦¬ì í™•ì¸/ìˆ˜ì •]
    â”‚
    â–¼
saveProductToDB(formData)
    â”‚
    â”œâ”€â†’ listings í…Œì´ë¸” ì €ì¥
    â”œâ”€â†’ pms_configs í…Œì´ë¸” ì €ì¥
    â”œâ”€â†’ room_types í…Œì´ë¸” ì €ì¥
    â”œâ”€â†’ room_media í…Œì´ë¸” ì €ì¥
    â”œâ”€â†’ rate_plans í…Œì´ë¸” ì €ì¥
    â””â”€â†’ room_inventory í…Œì´ë¸” ì €ì¥ (30ì¼ ë¶„)
    â”‚
    â–¼
ì €ì¥ ì™„ë£Œ â†’ listing_id ë°˜í™˜
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 1. PMS ê´€ë ¨ í…Œì´ë¸”

#### `room_types` - ê°ì‹¤ íƒ€ì… (ì •ì  ì •ë³´)
```sql
CREATE TABLE room_types (
  id SERIAL PRIMARY KEY,
  listing_id INT NOT NULL,                -- ì–´ë–¤ ìˆ™ì†Œì— ì†í•˜ëŠ”ì§€
  pms_vendor VARCHAR(50),                 -- 'cloudbeds', 'opera', etc
  pms_hotel_id VARCHAR(100),              -- PMS ì¸¡ í˜¸í…” ID
  pms_room_type_id VARCHAR(100),          -- PMS ì¸¡ ê°ì‹¤ íƒ€ì… ID
  room_type_name VARCHAR(255) NOT NULL,   -- ì˜ˆ: Deluxe Double Room
  description TEXT,
  max_occupancy INT NOT NULL,
  bed_type VARCHAR(50),                   -- King, Queen, Twin
  bed_count INT,
  room_size DECIMAL(10,2),                -- í‰ë°©ë¯¸í„°
  view_type VARCHAR(50),                  -- Ocean View, City View
  bathroom_type VARCHAR(50),
  amenities JSONB,                        -- ["WiFi", "TV", "Mini Bar"]
  check_in_time TIME,
  check_out_time TIME,
  house_rules TEXT,
  cancellation_policy TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `room_media` - ê°ì‹¤ ì´ë¯¸ì§€
```sql
CREATE TABLE room_media (
  id SERIAL PRIMARY KEY,
  room_type_id INT NOT NULL,
  media_type VARCHAR(20) NOT NULL,        -- 'image', 'video', '360_view'
  media_url TEXT NOT NULL,
  thumbnail_url TEXT,
  alt_text VARCHAR(255),
  display_order INT DEFAULT 0,
  is_primary BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### `rate_plans` - ìš”ê¸ˆ í”Œëœ
```sql
CREATE TABLE rate_plans (
  id SERIAL PRIMARY KEY,
  room_type_id INT NOT NULL,
  pms_rate_plan_id VARCHAR(100),
  rate_plan_name VARCHAR(255) NOT NULL,
  base_price DECIMAL(10,2) NOT NULL,
  currency VARCHAR(10) DEFAULT 'KRW',
  min_stay INT,
  max_stay INT,
  is_refundable BOOLEAN DEFAULT TRUE,
  cancellation_hours INT,                 -- ì·¨ì†Œ ê°€ëŠ¥ ì‹œê°„
  cancellation_fee_percent INT,           -- ì·¨ì†Œ ìˆ˜ìˆ˜ë£Œ (%)
  breakfast_included BOOLEAN DEFAULT FALSE,
  valid_from DATE,
  valid_until DATE,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `room_inventory` - ë‚ ì§œë³„ ì¬ê³  (ë™ì  ë°ì´í„°)
```sql
CREATE TABLE room_inventory (
  id SERIAL PRIMARY KEY,
  room_type_id INT NOT NULL,
  date DATE NOT NULL,
  available INT NOT NULL,                 -- ë‚¨ì€ ê°ì‹¤ ìˆ˜
  total INT NOT NULL,                     -- ì „ì²´ ê°ì‹¤ ìˆ˜
  price_override DECIMAL(10,2),           -- íŠ¹ì • ë‚ ì§œ ìš”ê¸ˆ ì˜¤ë²„ë¼ì´ë“œ
  min_stay_override INT,
  closed_to_arrival BOOLEAN DEFAULT FALSE,
  closed_to_departure BOOLEAN DEFAULT FALSE,
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(room_type_id, date)
);

CREATE INDEX idx_room_inventory_date ON room_inventory(room_type_id, date);
```

#### `pms_configs` - PMS ì„¤ì •
```sql
CREATE TABLE pms_configs (
  id SERIAL PRIMARY KEY,
  listing_id INT NOT NULL,
  vendor VARCHAR(50) NOT NULL,
  hotel_id VARCHAR(100) NOT NULL,
  api_key_encrypted TEXT NOT NULL,        -- ì•”í˜¸í™”ëœ API í‚¤
  api_base_url TEXT,
  webhook_enabled BOOLEAN DEFAULT FALSE,
  webhook_secret VARCHAR(255),
  polling_enabled BOOLEAN DEFAULT TRUE,
  polling_interval_seconds INT DEFAULT 300,
  last_sync_at TIMESTAMP,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `pms_booking_records` - PMS ì˜ˆì•½ ì—°ë™ ê¸°ë¡
```sql
CREATE TABLE pms_booking_records (
  id SERIAL PRIMARY KEY,
  booking_id INT NOT NULL,
  pms_vendor VARCHAR(50) NOT NULL,
  pms_hotel_id VARCHAR(100) NOT NULL,
  pms_booking_id VARCHAR(100) NOT NULL,
  pms_confirmation_number VARCHAR(100),
  hold_id VARCHAR(100),
  hold_expires_at TIMESTAMP,
  status VARCHAR(20) NOT NULL,            -- 'hold', 'confirmed', 'cancelled', 'failed'
  payment_auth_id VARCHAR(100),
  payment_transaction_id VARCHAR(100),
  error_message TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `pms_webhook_events` - ì›¹í›… ì´ë²¤íŠ¸ ê¸°ë¡
```sql
CREATE TABLE pms_webhook_events (
  id SERIAL PRIMARY KEY,
  vendor VARCHAR(50) NOT NULL,
  event_id VARCHAR(100) NOT NULL,
  event_type VARCHAR(50) NOT NULL,        -- 'inventory_update', 'rate_update', etc
  hotel_id VARCHAR(100) NOT NULL,
  room_type_id VARCHAR(100),
  payload JSONB NOT NULL,
  processed BOOLEAN DEFAULT FALSE,
  processed_at TIMESTAMP,
  error_message TEXT,
  idempotency_key VARCHAR(255) NOT NULL,  -- ì¤‘ë³µ ë°©ì§€
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(vendor, event_id, idempotency_key)
);
```

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### 1. ì¬ê³  ì¡°íšŒ
```
GET /api/inventory/:hotelId/:roomTypeId
Query: startDate, endDate

Response:
{
  "success": true,
  "data": [
    {
      "hotelId": "hotel_123",
      "roomTypeId": "room_456",
      "date": "2025-11-01",
      "available": 5,
      "total": 10,
      "updatedAt": "2025-10-10T12:00:00Z"
    }
  ]
}
```

### 2. ì˜ˆì•½ í™•ì •
```
POST /api/booking/checkout
Body:
{
  "vendor": "cloudbeds",
  "hotelId": "hotel_123",
  "roomTypeId": "room_456",
  "checkIn": "2025-11-01",
  "checkOut": "2025-11-03",
  "guestInfo": { ... },
  "payment": { ... }
}

Response:
{
  "success": true,
  "bookingId": "booking_789",
  "confirmationNumber": "CONF-123456"
}
```

### 3. Admin - PMS ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
```
POST /api/admin/pms/fetch-hotel-data
Body:
{
  "vendor": "cloudbeds",
  "hotelId": "hotel_123",
  "apiKey": "your_api_key"
}

Response:
{
  "success": true,
  "data": {
    "hotelName": "Ocean View Hotel",
    "location": "ì œì£¼ì‹œ",
    "roomTypes": [ ... ]
  }
}
```

### 4. ì›¹í›… ìˆ˜ì‹ 
```
POST /api/webhooks/pms/:vendor
Headers:
  x-pms-signature: <HMAC SHA256 signature>
Body:
{
  "eventId": "evt_123",
  "eventType": "inventory_update",
  "hotelId": "hotel_123",
  "roomTypeId": "room_456",
  "timestamp": "2025-10-10T12:00:00Z",
  "data": { ... }
}

Response:
{
  "success": true
}
```

---

## âš™ï¸ í™˜ê²½ ë³€ìˆ˜

```bash
# .env

# PMS API Keys (í˜¸í…”ë³„)
PMS_hotel_123_API_KEY=your_cloudbeds_api_key
PMS_hotel_456_API_KEY=your_opera_api_key

# Redis
REDIS_URL=redis://localhost:6379

# Payment Gateway
PAYMENT_API_KEY=your_toss_api_key
PAYMENT_SECRET_KEY=your_toss_secret_key

# Webhook
PMS_WEBHOOK_SECRET=your_webhook_secret

# DB
DATABASE_URL=postgresql://user:password@localhost:5432/travleap
```

---

## ğŸš€ ë°°í¬ ë° ì‹¤í–‰

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½

```bash
# 1. Redis ì‹œì‘
docker run -d -p 6379:6379 redis:7-alpine

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env

# 3. ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# 4. ì„œë²„ ì‹œì‘
npm run dev

# 5. í´ë§ ì‘ì—… ì‹œì‘ (ë³„ë„ í„°ë¯¸ë„)
node scripts/start-polling.js
```

### 2. í”„ë¡œë•ì…˜ ë°°í¬

```bash
# 1. Docker Composeë¡œ Redis + DB ì‹¤í–‰
docker-compose up -d

# 2. ë¹Œë“œ
npm run build

# 3. ì„œë²„ ì‹œì‘ (PM2)
pm2 start ecosystem.config.js

# 4. í´ë§ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
pm2 start ecosystem.config.js --only polling-scheduler
```

---

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ì£¼ìš” ë©”íŠ¸ë¦­

1. **ìºì‹œ íˆíŠ¸ìœ¨**
   ```typescript
   const hitRate = cacheHits / (cacheHits + cacheMisses);
   console.log(`Cache Hit Rate: ${(hitRate * 100).toFixed(2)}%`);
   ```

2. **PMS API ì‘ë‹µ ì‹œê°„**
   ```typescript
   const avgResponseTime = totalResponseTime / totalRequests;
   console.log(`Avg PMS Response Time: ${avgResponseTime}ms`);
   ```

3. **Hold ë§Œë£Œìœ¨**
   ```typescript
   const holdExpiredRate = holdExpired / totalHolds;
   console.log(`Hold Expired Rate: ${(holdExpiredRate * 100).toFixed(2)}%`);
   ```

### ì•Œë¦¼ ì„¤ì •

- PMS API 5íšŒ ì—°ì† ì‹¤íŒ¨ â†’ Slack ì•Œë¦¼
- Circuit Breaker OPEN â†’ ì´ë©”ì¼ ì•Œë¦¼
- í´ë§ 5íšŒ ì—°ì† ì‹¤íŒ¨ â†’ ê´€ë¦¬ì ì•Œë¦¼

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **API Key ì•”í˜¸í™”**
   - DB ì €ì¥ ì‹œ AES-256ìœ¼ë¡œ ì•”í˜¸í™”
   - í™˜ê²½ ë³€ìˆ˜ëŠ” Vault ì‚¬ìš© ê¶Œì¥

2. **ì›¹í›… ì„œëª… ê²€ì¦**
   - HMAC SHA256ìœ¼ë¡œ ê²€ì¦
   - Replay Attack ë°©ì§€ (íƒ€ì„ìŠ¤íƒ¬í”„ ì²´í¬)

3. **Rate Limiting**
   - PMS API í˜¸ì¶œ: ë¶„ë‹¹ 100íšŒ
   - ì‚¬ìš©ì ê²€ìƒ‰: IPë‹¹ ë¶„ë‹¹ 60íšŒ

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: ìºì‹œ ë¯¸ìŠ¤ê°€ ë„ˆë¬´ ë§ìŒ
**ì›ì¸:** TTLì´ ë„ˆë¬´ ì§§ìŒ
**í•´ê²°:** `CacheTTL.inventory`ë¥¼ 90ì´ˆ â†’ 120ì´ˆë¡œ ì¦ê°€

### ë¬¸ì œ: í´ë§ì´ ìë™ ì¤‘ì§€ë¨
**ì›ì¸:** ì—°ì† 5íšŒ ì‹¤íŒ¨
**í•´ê²°:** `pms_configs` í…Œì´ë¸”ì—ì„œ `last_sync_at` í™•ì¸, PMS API í‚¤ ì¬í™•ì¸

### ë¬¸ì œ: Hold ë§Œë£Œ ì—ëŸ¬ ë¹ˆë°œ
**ì›ì¸:** ê²°ì œ ì²˜ë¦¬ê°€ 180ì´ˆ ì•ˆì— ì™„ë£Œë˜ì§€ ì•ŠìŒ
**í•´ê²°:** Hold TTLì„ 300ì´ˆë¡œ ì¦ê°€ ë˜ëŠ” ê²°ì œ í”„ë¡œì„¸ìŠ¤ ìµœì í™”

---

## ğŸ“ ë¬¸ì˜

- ê¸°ìˆ  ë¬¸ì˜: dev@travleap.com
- PMS ì—°ë™ ìš”ì²­: partnerships@travleap.com
