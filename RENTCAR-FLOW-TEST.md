# ë ŒíŠ¸ì¹´ ì˜ˆì•½ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ¯ í…ŒìŠ¤íŠ¸ ëª©ì 
ë ŒíŠ¸ì¹´ ì˜ˆì•½ ì‹œìŠ¤í…œì˜ ì „ì²´ í”Œë¡œìš°ê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. ì‚¬ìš©ì ì¸ì¦ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ ì—†ì´ ì˜ˆì•½ ì‹œë„ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€ (returnUrl)
- [ ] ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ê°€ ì˜ˆì•½ì— ìë™ ì…ë ¥ë¨

### 2. ì°¨ëŸ‰ ê²€ìƒ‰ ë° ì„ íƒ
- [ ] `/rentcar` - ë ŒíŠ¸ì¹´ ëª©ë¡ í˜ì´ì§€ ì ‘ê·¼
- [ ] ì—…ì²´ë³„ ì°¨ëŸ‰ í•„í„°ë§
- [ ] ì°¨ëŸ‰ í´ë˜ìŠ¤ë³„ í•„í„°ë§
- [ ] ê°€ê²©ìˆœ/ì¸ê¸°ìˆœ ì •ë ¬

### 3. ì°¨ëŸ‰ ìƒì„¸ í˜ì´ì§€ (RentcarVehicleDetailPage)
#### ì ‘ê·¼
- [ ] `/rentcar/vehicle/{vehicleId}` ì ‘ê·¼

#### ë‚ ì§œ/ì‹œê°„ ì„ íƒ
- [ ] í”½ì—… ë‚ ì§œ ì„ íƒ
- [ ] í”½ì—… ì‹œê°„ ì„ íƒ (00:00 ~ 23:00)
- [ ] ë°˜ë‚© ë‚ ì§œ ì„ íƒ
- [ ] ë°˜ë‚© ì‹œê°„ ì„ íƒ
- [ ] ìµœì†Œ 4ì‹œê°„ ì´ìƒ ê²€ì¦
- [ ] ì´ ëŒ€ì—¬ ì‹œê°„ ê³„ì‚° í‘œì‹œ
- [ ] ì‹œê°„ë‹¹ ìš”ê¸ˆ ê³„ì‚° í‘œì‹œ

#### ì˜ˆì•½í•˜ê¸° ë²„íŠ¼
- [ ] ë¡œê·¸ì¸ ì²´í¬
- [ ] ë‚ ì§œ ë¯¸ì„ íƒ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] 4ì‹œê°„ ë¯¸ë§Œ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] ê°€ìš©ì„± í™•ì¸ API í˜¸ì¶œ
- [ ] ì˜ˆì•½ ìƒì„± API í˜¸ì¶œ
- [ ] bookingId ë°›ìŒ
- [ ] ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™

### 4. ì—…ì²´ ìƒì„¸ í˜ì´ì§€ (RentcarVendorDetailPage)
#### ì ‘ê·¼
- [ ] `/rentcar/{vendorId}` ì ‘ê·¼

#### ì°¨ëŸ‰ ëª©ë¡ í‘œì‹œ
- [ ] ì—…ì²´ì˜ ëª¨ë“  ì°¨ëŸ‰ í‘œì‹œ
- [ ] ë‚ ì§œ ì„ íƒ ì‹œ ì¬ê³  í‘œì‹œ
- [ ] ë²„í¼ íƒ€ì„(60ë¶„) ì ìš©ëœ ê°€ìš©ì„± ì²´í¬
- [ ] ì˜ˆì•½ ë¶ˆê°€ ì°¨ëŸ‰ í‘œì‹œ

#### ì°¨ëŸ‰ ì„ íƒ ë° ì˜ˆì•½
- [ ] ì°¨ëŸ‰ ì„ íƒ
- [ ] ë‚ ì§œ/ì‹œê°„ ì„ íƒ
- [ ] ì˜ˆì•½ ì •ë³´ ë¯¸ë¦¬ë³´ê¸°
- [ ] ë¡œê·¸ì¸ ì²´í¬
- [ ] ì˜ˆì•½ ìƒì„±
- [ ] ê²°ì œ í˜ì´ì§€ ì´ë™

### 5. ê°€ìš©ì„± í™•ì¸ API
#### ì—”ë“œí¬ì¸íŠ¸
```
GET /api/rentcar/check-availability
```

#### íŒŒë¼ë¯¸í„°
- `vehicle_id`: ì°¨ëŸ‰ ID
- `pickup_date`: í”½ì—… ë‚ ì§œ (YYYY-MM-DD)
- `pickup_time`: í”½ì—… ì‹œê°„ (HH:mm)
- `dropoff_date`: ë°˜ë‚© ë‚ ì§œ (YYYY-MM-DD)
- `dropoff_time`: ë°˜ë‚© ì‹œê°„ (HH:mm)

#### ê²€ì¦ í•­ëª©
- [ ] ì°¨ëŸ‰ í™œì„± ìƒíƒœ í™•ì¸ (`is_active = 1`)
- [ ] ê¸°ì¡´ ì˜ˆì•½ê³¼ ì¶©ëŒ ì—¬ë¶€ í™•ì¸
- [ ] ë²„í¼ íƒ€ì„ 60ë¶„ ì ìš©
- [ ] ì‹œê°„ ê¸°ë°˜ ê²¹ì¹¨ ì²´í¬
- [ ] ì¶©ëŒ ì‹œ ì´ìœ  ë°˜í™˜

### 6. ì˜ˆì•½ ìƒì„± API
#### ì—”ë“œí¬ì¸íŠ¸
```
POST /api/rentcar/bookings
```

#### ìš”ì²­ ë°ì´í„° (snake_case)
```json
{
  "vendor_id": 165,
  "vehicle_id": 123,
  "user_id": 1,
  "customer_name": "í™ê¸¸ë™",
  "customer_email": "hong@example.com",
  "customer_phone": "010-1234-5678",
  "pickup_location_id": 1,
  "dropoff_location_id": 1,
  "pickup_date": "2025-01-15",
  "pickup_time": "10:00",
  "dropoff_date": "2025-01-18",
  "dropoff_time": "18:00",
  "special_requests": ""
}
```

#### ê²€ì¦ í•­ëª©
- [ ] ìµœì†Œ 4ì‹œê°„ ê²€ì¦
- [ ] ì¶©ëŒ ê°ì§€ (ë²„í¼ íƒ€ì„ í¬í•¨)
- [ ] ì‹œê°„ ê¸°ë°˜ ìš”ê¸ˆ ê³„ì‚°
- [ ] booking_number ìƒì„± (`RC{timestamp}`)
- [ ] `status = 'pending'`
- [ ] `payment_status = 'pending'`
- [ ] DBì— ì €ì¥ (`rentcar_bookings`)

### 7. ê²°ì œ í˜ì´ì§€ (PaymentPage)
#### ì ‘ê·¼
```
/payment?bookingId=123&bookingNumber=RC...&amount=150000&title=ì°¨ëŸ‰ëª…&customerName=í™ê¸¸ë™&customerEmail=hong@example.com
```

#### ê²€ì¦ í•­ëª©
- [ ] bookingId ì¡´ì¬ í™•ì¸
- [ ] bookingNumber ì¡´ì¬ í™•ì¸
- [ ] PaymentWidget í‘œì‹œ
- [ ] Toss Payments ìœ„ì ¯ ë¡œë“œ
- [ ] ì˜ˆì•½ ì •ë³´ í‘œì‹œ
- [ ] ê²°ì œ ê¸ˆì•¡ í‘œì‹œ

### 8. ê²°ì œ ì„±ê³µ í˜ì´ì§€ (PaymentSuccessPage)
#### ì²˜ë¦¬ í”Œë¡œìš°
1. [ ] Toss Payments ìŠ¹ì¸ ìš”ì²­
2. [ ] `/api/rentcar/bookings/payment` POST - ê²°ì œ ì •ë³´ ì €ì¥
3. [ ] `/api/rentcar/bookings/{id}` PUT - ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸
   - `booking_status = 'confirmed'`
   - `payment_status = 'completed'`
4. [ ] ì°¨ëŸ‰ ì˜ˆì•½ ë¶ˆê°€ ì²˜ë¦¬ (`is_active = 0`)
5. [ ] ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™

### 9. ë²¤ë” ëŒ€ì‹œë³´ë“œ
#### ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ
```
GET /api/vendor/bookings
```

#### ê²€ì¦ í•­ëª©
- [ ] JWT í† í° ì¸ì¦
- [ ] ë²¤ë” ê¶Œí•œ í™•ì¸
- [ ] vendor_id ì¡°íšŒ
- [ ] ì˜ˆì•½ ëª©ë¡ ë°˜í™˜
  - `pickup_time`, `dropoff_time` í¬í•¨ âœ…
  - `vehicle_name` í¬í•¨
  - `customer_info` í¬í•¨
- [ ] `total_krw` ì»¬ëŸ¼ ì‚¬ìš© âœ…

### 10. ê´€ë¦¬ì í˜ì´ì§€
#### ì „ì²´ ì˜ˆì•½ ì¡°íšŒ
```
GET /api/admin/rentcar/bookings
```

#### ê²€ì¦ í•­ëª©
- [ ] ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
- [ ] ëª¨ë“  ì˜ˆì•½ ì¡°íšŒ
- [ ] ì°¨ëŸ‰ëª… í¬í•¨ (`vehicle_name`)
- [ ] ì—…ì²´ëª… í¬í•¨ (`vendor_name`)
- [ ] ì‹œê°„ ì •ë³´ í¬í•¨ (`pickup_time`, `dropoff_time`) âœ…
- [ ] `dropoff_date` ì»¬ëŸ¼ ì‚¬ìš© âœ…
- [ ] `total_krw` ì»¬ëŸ¼ ì‚¬ìš© âœ…

### 11. ì°¨ëŸ‰ ë°˜ë‚© ì²˜ë¦¬ (ë²¤ë”)
#### ì—”ë“œí¬ì¸íŠ¸
```
POST /api/rentcar/process-return
```

#### ìš”ì²­ ë°ì´í„°
```json
{
  "booking_id": 123,
  "actual_dropoff_time": "2025-01-18T18:30:00",
  "vendor_note": "ì •ìƒ ë°˜ë‚©"
}
```

#### ê²€ì¦ í•­ëª©
- [ ] JWT ì¸ì¦ (ë²¤ë”)
- [ ] ì˜ˆì•½ ì •ë³´ ì¡°íšŒ
- [ ] ì˜ˆì • ì‹œê°„ vs ì‹¤ì œ ì‹œê°„ ë¹„êµ
- [ ] ì§€ì—° ìˆ˜ìˆ˜ë£Œ ê³„ì‚°
  - 15ë¶„ ì´ë‚´: ë¬´ë£Œ
  - 15ë¶„~1ì‹œê°„: â‚©10,000
  - 1~2ì‹œê°„: â‚©20,000
  - 2ì‹œê°„ ì´ˆê³¼: ì‹œê°„ë‹¹ Ã— 1.5ë°°
- [ ] `status = 'completed'`
- [ ] `total_krw` ì—…ë°ì´íŠ¸ (ì§€ì—° ìˆ˜ìˆ˜ë£Œ ì¶”ê°€)
- [ ] ë‹¤ìŒ ì˜ˆì•½ ì•Œë¦¼ (í•„ìš”ì‹œ)

## ğŸ”§ ì»¬ëŸ¼ëª… ê²€ì¦

### âœ… ìˆ˜ì • ì™„ë£Œ (6ê°œ íŒŒì¼)
1. `api/vendor/revenue.js` - `total_krw` âœ…
2. `pages/api/vendor/revenue.js` - `total_krw` âœ…
3. `pages/api/vendor/bookings.js` - `total_krw` âœ…
4. `api/vendor/bookings.js` - `total_krw` âœ…
5. `api/rentcars/[vendorId]/bookings.js` - `dropoff_date` âœ…
6. `pages/api/admin/rentcar/bookings.js` - `dropoff_date`, `total_krw` âœ…

### ì •í™•í•œ ì»¬ëŸ¼ëª…
- âœ… `total_krw` (NOT `total_amount_krw`, `total_price_krw`)
- âœ… `dropoff_date` (NOT `return_date`)
- âœ… `dropoff_time` (NOT `return_time`)
- âœ… `pickup_date`, `pickup_time`

## ğŸ“ ë°ì´í„° í˜•ì‹

### snake_case ì‚¬ìš© (ë°±ì—”ë“œ API)
```javascript
{
  vendor_id: 165,
  vehicle_id: 123,
  pickup_date: "2025-01-15",
  pickup_time: "10:00",
  dropoff_date: "2025-01-18",
  dropoff_time: "18:00",
  customer_name: "í™ê¸¸ë™",
  customer_email: "hong@example.com",
  customer_phone: "010-1234-5678"
}
```

### í”„ë¡ íŠ¸ì—”ë“œ â†’ ë°±ì—”ë“œ ë³€í™˜
- âŒ `pickupTime` â†’ âœ… `pickup_time`
- âŒ `returnDate` â†’ âœ… `dropoff_date`
- âŒ `returnTime` â†’ âœ… `dropoff_time`

## ğŸ‰ ì‚¬ìš©ì ì¸ì¦ ì—°ë™

### useAuth í›… ì‚¬ìš©
```typescript
import { useAuth } from '../../hooks/useAuth';

const { user, isLoggedIn } = useAuth();

// ë¡œê·¸ì¸ ì²´í¬
if (!isLoggedIn || !user) {
  toast.error('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤');
  navigate('/login', { state: { returnUrl: currentPath } });
  return;
}

// ì‹¤ì œ ì‚¬ìš©ì ì •ë³´ ì‚¬ìš©
const bookingPayload = {
  user_id: user.id,
  customer_name: user.name,
  customer_email: user.email,
  customer_phone: user.phone || '',
  // ...
};
```

## ğŸš¨ ì—ëŸ¬ ì¼€ì´ìŠ¤

### 1. ë¡œê·¸ì¸ ì•ˆí•¨
- [ ] "ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤"
- [ ] ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] returnUrl ì €ì¥

### 2. ë‚ ì§œ ë¯¸ì„ íƒ
- [ ] "ëŒ€ì—¬/ë°˜ë‚© ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"

### 3. ìµœì†Œ ì‹œê°„ ë¯¸ë‹¬
- [ ] "ìµœì†Œ 4ì‹œê°„ ì´ìƒ ëŒ€ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤"

### 4. ì°¨ëŸ‰ ë¯¸ì„ íƒ (ì—…ì²´ í˜ì´ì§€)
- [ ] "ì°¨ëŸ‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”"

### 5. ì˜ˆì•½ ì¶©ëŒ
- [ ] "ì„ íƒí•˜ì‹  ë‚ ì§œ/ì‹œê°„ì— ì´ë¯¸ ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤"
- [ ] ë²„í¼ íƒ€ì„ 60ë¶„ ì•ˆë‚´

### 6. ì°¨ëŸ‰ ë¹„í™œì„±
- [ ] "ì°¨ëŸ‰ì´ í˜„ì¬ ì˜ˆì•½ ë¶ˆê°€ ìƒíƒœì…ë‹ˆë‹¤"

### 7. API ì˜¤ë¥˜
- [ ] "ì˜ˆì•½ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
- [ ] "ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"

## ğŸ“Š í†µí•© í…ŒìŠ¤íŠ¸ ìˆœì„œ

1. âœ… ë¡œê·¸ì¸
2. âœ… ì°¨ëŸ‰ ê²€ìƒ‰/ëª©ë¡
3. âœ… ì°¨ëŸ‰ ìƒì„¸ í˜ì´ì§€ ì ‘ê·¼
4. âœ… ë‚ ì§œ/ì‹œê°„ ì„ íƒ
5. âœ… ê°€ìš©ì„± í™•ì¸
6. âœ… ì˜ˆì•½ ìƒì„±
7. âœ… ê²°ì œ í˜ì´ì§€ ì´ë™
8. âœ… ê²°ì œ ì§„í–‰
9. âœ… ì˜ˆì•½ í™•ì •
10. âœ… ë²¤ë” ëŒ€ì‹œë³´ë“œ í™•ì¸
11. âœ… ê´€ë¦¬ì í˜ì´ì§€ í™•ì¸
12. âœ… ì°¨ëŸ‰ ë°˜ë‚© ì²˜ë¦¬

## ğŸ›  ê°œë°œì ë„êµ¬

### ì½˜ì†” ëª…ë ¹ì–´
```javascript
// í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
window.globalAuthState

// í† í° í™•ì¸
document.cookie

// ì˜ˆì•½ ìƒì„± í…ŒìŠ¤íŠ¸
fetch('/api/rentcar/bookings', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ /* ... */ })
})
```

### ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
```sql
-- ì˜ˆì•½ í™•ì¸
SELECT * FROM rentcar_bookings WHERE id = 123;

-- ì°¨ëŸ‰ ìƒíƒœ í™•ì¸
SELECT id, display_name, is_active FROM rentcar_vehicles WHERE id = 123;

-- ì¶©ëŒ ê°ì§€ í…ŒìŠ¤íŠ¸
SELECT * FROM rentcar_bookings
WHERE vehicle_id = 123
  AND status NOT IN ('cancelled', 'failed')
  AND pickup_date <= '2025-01-18'
  AND dropoff_date >= '2025-01-15';
```

## âœ… ìµœì¢… ê²€ì¦ ì™„ë£Œ
- [x] ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ëª… í†µì¼
- [x] í”„ë¡ íŠ¸ì—”ë“œâ†’ë°±ì—”ë“œ ë°ì´í„° í˜•ì‹ í†µì¼
- [x] ì‚¬ìš©ì ì¸ì¦ ì—°ë™
- [x] ì˜ˆì•½ ìƒì„± í”Œë¡œìš° ì™„ì„±
- [x] ê²°ì œ ì—°ë™
- [x] ì—ëŸ¬ ì²˜ë¦¬
- [x] ë¹Œë“œ ì„±ê³µ

ë‚ ì§œ: 2025-10-23
ìƒíƒœ: ì™„ë£Œ âœ…
